{% extends 'base.html' %}

{% block title %}
  Add Transaction
{% endblock %}

{% block content %}
  <h2 class="mb-4" style="color: #2581DC;">Add Transaction</h2>

  <form method="post" novalidate>
    {% csrf_token %}
    <div class="row g-3">
      <div class="col-md-6">
        {{ form.wallet.label_tag }}
        {{ form.wallet }}
        {% if form.wallet.errors %}
          <div class="text-danger small">{{ form.wallet.errors.0 }}</div>
        {% endif %}
      </div>

      <div class="col-md-6">
        {{ form.category.label_tag }}
        {{ form.category }}
        {% if form.category.errors %}
          <div class="text-danger small">{{ form.category.errors.0 }}</div>
        {% endif %}
      </div>

      <div class="col-md-6">
        {{ form.amount.label_tag }}
        {{ form.amount }}
        {% if form.amount.errors %}
          <div class="text-danger small">{{ form.amount.errors.0 }}</div>
        {% endif %}
      </div>

      <div class="col-md-6">
        {{ form.date.label_tag }}
        {{ form.date }}
        {% if form.date.errors %}
          <div class="text-danger small">{{ form.date.errors.0 }}</div>
        {% endif %}
      </div>

      <div class="col-12">
        {{ form.description.label_tag }}
        {{ form.description }}
        {% if form.description.errors %}
          <div class="text-danger small">{{ form.description.errors.0 }}</div>
        {% endif %}
      </div>

      <div class="col-12 mt-3">
        <div class="form-check">
          {{ form.is_recurring }}
          <label class="form-check-label" for="{{ form.is_recurring.id_for_label }}">Make this a recurring transaction</label>
        </div>
        {% if form.is_recurring.errors %}
          <div class="text-danger small">{{ form.is_recurring.errors.0 }}</div>
        {% endif %}
      </div>

      <div id="recurrence-fields" class="row g-3 mt-1" style="display: none;">
        <div class="col-md-6">
          {{ form.recurring_frequency.label_tag }}
          {{ form.recurring_frequency }}
          {% if form.recurring_frequency.errors %}
            <div class="text-danger small">{{ form.recurring_frequency.errors.0 }}</div>
          {% endif %}
        </div>

        <div class="col-md-6">
          {{ form.recurrence_end_date.label_tag }}
          {{ form.recurrence_end_date }}
          {% if form.recurrence_end_date.errors %}
            <div class="text-danger small">{{ form.recurrence_end_date.errors.0 }}</div>
          {% endif %}
        </div>
      </div>
    </div>

    <button type="submit" class="btn text-white mt-4" style="background-color: #2581DC;"><i class="fa-solid fa-save me-2"></i>Save Transaction</button>

    {% if form.non_field_errors %}
      <div class="alert alert-danger mt-3">
        {% for error in form.non_field_errors %}
          <p>{{ error }}</p>
        {% endfor %}
      </div>
    {% endif %}
  </form>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const checkbox = document.querySelector('#id_is_recurring')
      const recurrenceFields = document.getElementById('recurrence-fields')
    
      function toggleRecurrenceFields() {
        recurrenceFields.style.display = checkbox.checked ? 'flex' : 'none'
      }
    
      if (checkbox) {
        checkbox.addEventListener('change', toggleRecurrenceFields)
        toggleRecurrenceFields()
      }
    })
  </script>
{% endblock %}
